<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - BNCC Feedback</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Admin Dashboard (Feedback List)</h2>
      <button onclick="loadFeedbacks()" class="btn btn-success">
        üîÑ Refresh Data
      </button>
    </div>

    <div class="table-responsive shadow-sm">
      <table class="table table-bordered table-hover">
        <thead class="table-dark">
          <tr>
            <th>Date</th>
            <th>Name & Email</th>
            <th>Divisi</th>
            <th>Event</th>
            <th>Rating</th>
            <th>Comment</th>
            <th>Suggestion</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="feedbackTable"></tbody>
      </table>
    </div>

    <p class="text-muted mt-2">
      *Klik Refresh Data jika data baru belum muncul.
    </p>

    <script>
      const API_URL = "http://localhost:3000/api/feedback";

      async function loadFeedbacks() {
        try {
          const response = await fetch(API_URL);
          const result = await response.json();
          const feedbacks = result.data;

          const tableBody = document.getElementById("feedbackTable");
          tableBody.innerHTML = "";

          if (feedbacks.length === 0) {
            // Update colspan jadi 8 karena kolom nambah satu
            tableBody.innerHTML =
              '<tr><td colspan="8" class="text-center">Belum ada data feedback.</td></tr>';
            return;
          }

          feedbacks.forEach((item) => {
            const row = `
                        <tr>
                            <td>${new Date(
                              item.createdAt
                            ).toLocaleDateString()}</td>
                            <td>
                                <strong>${item.name}</strong><br>
                                <small class="text-muted">${item.email}</small>
                            </td>
                            <td><span class="badge bg-primary">${
                              item.division
                            }</span></td>
                            <td>${item.eventName}</td>
                            <td>‚≠ê ${item.rating}</td>
                            <td>${item.comment || "-"}</td>
                            <td>${item.suggestion || "-"}</td> <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteFeedback('${
                                  item.id
                                }')">
                                    Delete
                                </button>
                            </td>
                        </tr>
                    `;
            tableBody.innerHTML += row;
          });
        } catch (error) {
          console.error("Error loading data:", error);
          alert("Gagal mengambil data!");
        }
      }

      async function deleteFeedback(id) {
        if (!confirm("Yakin mau hapus feedback ini?")) return;

        try {
          const response = await fetch(`${API_URL}/${id}`, {
            method: "DELETE",
          });

          alert("Data berhasil dihapus!");
          loadFeedbacks();
        } catch (error) {
          console.error("Error deleting:", error);
          alert("Gagal menghapus data");
        }
      }

      loadFeedbacks();
    </script>
  </body>
</html>
